#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1in
\topmargin 1in
\rightmargin 1in
\bottommargin 1in
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Assignment: Demand Calculation
\end_layout

\begin_layout Section
Assignment
\end_layout

\begin_layout Standard
The goal of the assignment is to calculate the market share of 
\begin_inset Formula $j$
\end_inset

, 
\begin_inset Formula $s_{j}$
\end_inset

, from the BLP model using Julia.
 
\end_layout

\begin_layout Enumerate
Set-up: Go to XXX and download blp_example_data.csv and blp_example_grid.csv.
 Let 
\begin_inset Formula $u_{ij}=\beta_{0}+\sum_{k=1}^{3}\beta_{k}x_{k}+\sum_{k=2}^{3}\theta_{k}x_{jk}\eta_{ik}=\delta_{j}+\mu_{ij}$
\end_inset

 where 
\begin_inset Formula $\beta=(-5.0,\,1.0,\,1.0,\,1.0)$
\end_inset

 and 
\begin_inset Formula $\theta=(1.4,\,1.4)$
\end_inset

.
\end_layout

\begin_deeper
\begin_layout Enumerate
The data consists of 50 products in 20 markets with 100 customers (i.e., simulatio
ns).
\end_layout

\end_deeper
\begin_layout Enumerate
Write a new Julia file and load in the data.
 Hints: use the package, DataFrames.
\end_layout

\begin_layout Enumerate
One way of using computers to evaluate the intergral (defined in Equation
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:marketshare"

\end_inset

) is to use simulations.
 Write a function in Julia that calculates 
\begin_inset Formula $s_{j}\approx\sum_{i}^{I}(\frac{exp(\delta_{j}+\mu_{ij})}{1+\sum_{j'}^{J}exp(\delta_{j}+\mu_{ij})})w_{i}$
\end_inset

 for each market 
\begin_inset Formula $t$
\end_inset

.
 Be sure to write the function such that shares are evaluated for each market
 (i.e., 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $s_{j,t}$
\end_inset

).
\end_layout

\begin_deeper
\begin_layout Enumerate
\begin_inset Formula $I$
\end_inset

 is the total number of simulations and 
\begin_inset Formula $w_{i}$
\end_inset

 is the weight associated with each simulation.
 These are pre-specified in blp_example_grid.csv
\end_layout

\begin_layout Enumerate
Step 1: 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
construct a matrix of size 
\begin_inset Formula $J\,x\,I$
\end_inset

 with each element contaning the value,
\begin_inset Formula $\sum_{k}\theta_{k}x_{jk}\eta_{ik}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Step 2: construct 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
a matrix of size 
\begin_inset Formula $J\,x\,I$
\end_inset

 with each element contaning the value, 
\begin_inset Formula $\frac{exp(\delta_{j}+\mu_{ij})}{1+\sum_{j'}^{J}exp(\delta_{j}+\mu_{ij})}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Step 3: construct a vector of size 
\begin_inset Formula $J$
\end_inset

 with each element containing the value, 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\sum_{i}^{I}(\frac{exp(\delta_{j}+\mu_{ij})}{1+\sum_{j'}^{J}exp(\delta_{j}+\mu_{ij})})w_{i}$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Enumerate
Write a seperate Julia code that loops over each market, evaluate the function
 defined in 2, and store the market shares from all the markets in one large
 vector.
 Compute the norm of the difference between the computed market shares and
 the actual market shares.
 Design the code as the following:
\end_layout

\begin_deeper
\begin_layout Enumerate
Step 1: define a J*T by 1 empty vector of 
\begin_inset Formula $S_{j}$
\end_inset

 (i.e., 
\begin_inset Formula $S_{j}=(s_{j,1},s_{j,2},...,s_{j,T})$
\end_inset

.
\end_layout

\begin_layout Enumerate
Step 2: write a loop over the markets.
 For each loop, evaluate 
\begin_inset Formula $s_{jt}$
\end_inset

 defined in the previous part and update the appropriate part of 
\begin_inset Formula $S_{j}$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Enumerate
Optional: Parallelize the loop in 4 and measure the difference in time spent
 for evaluation.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
pagebreak
\end_layout

\end_inset


\end_layout

\begin_layout Section
Theory
\end_layout

\begin_layout Standard
This section is not necessary to complete the assignment above.
 Here, I provide the basic theory (i.e., derviation) of the logit and the
 random-coefficients (i.e., BLP) demand model.
 For the details of the derviation, look McFadden (1974), Berry (1994) and
 Berry, Levinsohn and Pakes (1995).
 Another useful reference is Kenneth Train's Discrete Choice Methods with
 Simulation (url: https://eml.berkeley.edu/books/choice2.html)
\end_layout

\begin_layout Subsection
Logit Demand Model
\begin_inset CommandInset label
LatexCommand label
name "subsec:Logit-Demand-Model"

\end_inset


\end_layout

\begin_layout Standard
Consider an individual 
\begin_inset Formula $i$
\end_inset

 making a discrete choice among 
\begin_inset Formula $J+1$
\end_inset

 alternatives/products.
 The utility she obtains if product 
\begin_inset Formula $j$
\end_inset

 is selected is
\end_layout

\begin_layout Standard
\align block
\begin_inset Formula 
\begin{align*}
u_{ij} & =X_{j}^{'}\beta+\epsilon_{ij}\\
 & =\delta_{j}+\epsilon_{ij}
\end{align*}

\end_inset

where 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\epsilon_{ij}$
\end_inset

 are i.i.d.
 Type-1- Extreme-Value (T1EV) random variates.
 
\end_layout

\begin_layout Standard
Then, the probability that 
\begin_inset Formula $i$
\end_inset

 chooses 
\begin_inset Formula $j$
\end_inset

 is
\end_layout

\begin_layout Standard
\align block
\begin_inset Formula 
\begin{align*}
P_{ij} & =Prob(\delta_{j}+\epsilon_{ij}>\delta_{j'}+\epsilon_{ij'}\,\forall j'\neq j)\\
 & =Prob(\epsilon_{ij'}<\delta_{j}-\delta_{j'}+\epsilon_{ij}\,\forall j'\neq j).
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
If 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\epsilon_{ij}$
\end_inset

 is given, the conditional probability of choosing 
\begin_inset Formula $j$
\end_inset

 is 
\end_layout

\begin_layout Standard
\align block
\begin_inset Formula 
\begin{align*}
P_{ij}|\epsilon_{ij} & =\prod_{j'\neq j}exp(-exp(-(\delta_{j}-\delta_{j'}+\epsilon_{ij}))).
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Because 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\epsilon_{ij}$
\end_inset

 is not given, we need to integrate out the 
\begin_inset Formula $\epsilon_{ij}$
\end_inset

 to obtain the unconditional probability of choosing 
\begin_inset Formula $j$
\end_inset

:
\end_layout

\begin_layout Standard
\align block
\begin_inset Formula 
\begin{align*}
P_{ij} & =\int(\prod_{j'\neq j}exp(-exp(-(\delta_{j}-\delta_{j'}+\epsilon_{ij}))))e^{-\epsilon_{ij}}e^{-e^{-\epsilon_{ij}}}d(\epsilon_{ij}).\\
 & =\frac{exp(\delta_{j})}{\sum_{j'}^{J+1}exp(\delta_{j'})}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
If the alternative 
\begin_inset Formula $j=0$
\end_inset

 (i.e., the outside option of not buying) is normalized (i.e., 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\delta_{0}=0$
\end_inset

), 
\begin_inset Formula $P_{ij}=\frac{exp(\delta_{j})}{1+\sum_{j'}^{J}exp(\delta_{j'})}$
\end_inset

.
 Since 
\begin_inset Formula $i$
\end_inset

 is a representative agent, 
\begin_inset Formula $P_{ij}$
\end_inset

 is the market share, 
\begin_inset Formula $s_{j}$
\end_inset

, of the alternative 
\begin_inset Formula $j$
\end_inset

.
\end_layout

\begin_layout Subsection
Random-coefficients Demand Model
\end_layout

\begin_layout Standard
Let's introduce heterogeneity to attenuate the problems of the IIA property
 of the logit model.
 That is, let 
\begin_inset Formula $\beta$
\end_inset

 be individual-specific.
 Then, the utility can be written as
\end_layout

\begin_layout Standard
\align block
\begin_inset Formula 
\begin{align*}
u_{ij} & =X_{j}^{'}\boldsymbol{\beta}_{\boldsymbol{\boldsymbol{i}}}+\epsilon_{ij}\\
 & =X_{j}^{'}\beta+\sum_{k}\theta_{k}x_{jk}\eta_{ik}+\epsilon_{ij}
\end{align*}

\end_inset

where 
\begin_inset Formula $\eta_{i}\sim F_{\eta}$
\end_inset

 denote the marginal utilities for product characteristics.
 Now, because individuals are different in utils one can drive from the
 same product, we need to integrate not only the 
\begin_inset Formula $\epsilon_{ij}$
\end_inset

 but also the 
\begin_inset Formula $\eta_{ik}$
\end_inset

 in order to obtain the market share of the product 
\begin_inset Formula $j$
\end_inset

.
 That is, 
\begin_inset Formula 
\begin{align}
s_{j} & =\int(\frac{exp(\delta_{j}+\sum_{k}\theta_{k}x_{jk}\eta_{ik})}{1+\sum_{j'}^{J}exp(\delta_{j'+\sum_{k}\theta_{k}x_{jk}\eta_{ik}})})dF_{\nu}(\eta_{i}).\label{eq:marketshare}
\end{align}

\end_inset


\end_layout

\end_body
\end_document
